<nz-layout>
  <!-- Sidebar per i contatti -->
  <nz-sider
    [nzWidth]="300"
    [nzCollapsible]="true"
    [(nzCollapsed)]="isCollapsed"
    [nzTrigger]="null"
  >
    <div class="logo">
      <h2 *ngIf="!isCollapsed" class="sidebar-header fs-5">Chat</h2>
    </div>
    <ul nz-menu nzTheme="dark" nzMode="inline">
      <li
        *ngFor="let contact of contacts"
        nz-menu-item
        (click)="selectContact(contact)"
        onkeydown="selectContact(contact)"
      >
        <nz-avatar
          nzSize="small"
          nzText="{{ contact.avatar[0] }}"
          class="contact-avatar"
        ></nz-avatar>
        <span class="contact-name" *ngIf="!isCollapsed">{{
          contact.name
        }}</span>
      </li>
    </ul>
  </nz-sider>

  <!-- Layout principale -->
  <nz-layout>
    <nz-header>
      <div
        class="d-flex flex-column justify-content-start align-items-start"
        *ngIf="selectedContact"
      >
        <div class="d-flex align-items-center h-25">
          <nz-avatar
            nzSize="large"
            nzText="{{ selectedContact.avatar[0] }}"
            class="contact-avatar mr-3"
            (click)="isDrawerVisible = true"
            onkeyup="openDrawer()"
          ></nz-avatar>
          <div>
            <h3 class="contact-name">{{ selectedContact.name }}</h3>
            <span class="last-seen"
              >Ultimo accesso alle:
              {{ selectedContact.lastActive | date : "HH:mm" }}</span
            >
          </div>
        </div>
      </div>
    </nz-header>

    <nz-drawer
      [nzClosable]="true"
      [nzVisible]="isDrawerVisible"
      nzPlacement="right"
      nzTitle="Info contatto"
      (nzOnClose)="isDrawerVisible = false"
    >
      <ng-container *nzDrawerContent>
        <div class="details-info" *ngIf="selectedContact">
          <nz-avatar
            nzSize="large"
            nzText="{{ selectedContact.avatar[0] }}"
            class="details-avatar"
          ></nz-avatar>
          <h3 class="details-name">{{ selectedContact.name }}</h3>
          <p class="details-number">+39 366 4567890</p>

          <div class="details-info-text">
            <p class="details-info-title">Info</p>
            <p>Ciao! Sto usando WhatsApp.</p>
          </div>
        </div>
      </ng-container>
    </nz-drawer>

    <nz-content>
      <div class="chat-container">
        <!-- Chat selezionata -->
        <div
          *ngIf="selectedContact; else noContactSelected"
          class="chat-content"
        >
          <div class="messages">
            <div
              *ngFor="let message of selectedContact.messages"
              [class]="
                message.sender === 'me'
                  ? 'message outgoing'
                  : 'message incoming'
              "
            >
              <p>{{ message.content }}</p>
              <span class="message-time">{{
                message.timestamp | date : "HH:mm"
              }}</span>
            </div>
          </div>
        </div>

        <!-- Input per inviare messaggi -->
        <div *ngIf="isContactSelected" class="message-input-container">
          <button class="add-button">+</button>
          <input
            [(ngModel)]="newMessageContent"
            placeholder="Scrivi un messaggio"
            (keyup.enter)="sendMessage()"
            class="message-input"
          />
          <button (click)="sendMessage()" class="send-button">
            <img
              src="../../../assets/images/whatsApp/send.svg"
              alt="Send Message"
            />
          </button>
        </div>
        <!-- Messaggio se nessun contatto Ã¨ selezionato -->
        <ng-template #noContactSelected>
          <div class="no-contact">
            <p>Seleziona un contatto per iniziare a chattare!</p>
          </div>
        </ng-template>
      </div>
    </nz-content>
  </nz-layout>
</nz-layout>
